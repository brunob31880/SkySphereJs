(this.webpackJsonpskyspherejs=this.webpackJsonpskyspherejs||[]).push([[0],{42:function(e,t){},58:function(e,t,n){},59:function(e,t,n){},70:function(e,t,n){},71:function(e,t,n){},72:function(e,t,n){"use strict";n.r(t);var r=n(8),a=n.n(r),o=n(48),i=n.n(o),c=(n(58),n(13)),s=(n(59),n(26)),u=n(0),l=n(11);var d=function(){var e=Object(r.useRef)();return Object(r.useEffect)((function(){for(var t=new u.LineDashedMaterial({color:65280,dashSize:10,gapSize:5}),n=new u.LineDashedMaterial({color:255,dashSize:10,gapSize:5}),r=function(e){for(var t=new u.BufferGeometry,n=new Float32Array(195),r=0;r<=64;r++){var a=r/64*Math.PI*2;n[3*r]=e*Math.cos(a),n[3*r+1]=0,n[3*r+2]=e*Math.sin(a)}return t.setAttribute("position",new u.BufferAttribute(n,3)),t},a=0;a<360;a+=10){var o=r(1e3);o.rotateZ(u.MathUtils.degToRad(90)),o.rotateY(u.MathUtils.degToRad(a));var i=new u.Line(o,t);i.computeLineDistances(),e.current.add(i)}for(var c=-90;c<90;c+=10){var s=r(1e3*Math.cos(u.MathUtils.degToRad(c))),l=new u.Line(s,n);l.translateY(1e3*Math.sin(u.MathUtils.degToRad(c))),l.computeLineDistances(),e.current.add(l)}}),[]),Object(l.jsx)("group",{ref:e})};var f=function(){var e=Object(r.useRef)();return Object(r.useEffect)((function(){e.current&&(e.current.renderOrder=1)}),[]),Object(l.jsxs)("mesh",{ref:e,rotation:[-Math.PI/2,0,0],children:[Object(l.jsx)("ringBufferGeometry",{attach:"geometry",args:[0,1e3,64]}),Object(l.jsx)("meshBasicMaterial",{attach:"material",color:16777215,side:u.DoubleSide,transparent:!0,opacity:.1,depthWrite:!1})]})},j=n(14),h=n(74);var b=function(){var e=Object(j.k)(),t=e.camera,n=e.gl,a=Object(r.useState)(new u.Vector3(0,0,-1)),o=Object(c.a)(a,2),i=o[0],s=o[1];return Object(r.useEffect)((function(){function e(e){s(new u.Vector3(e.clientX,e.clientY,0))}var t=n.domElement;return t.addEventListener("mousemove",e),function(){t.removeEventListener("mousemove",e)}}),[n.domElement]),Object(r.useEffect)((function(){t.lookAt(i)}),[i,t]),Object(l.jsx)(h.a,{})},v=n(17),g=function(e){return e*(Math.PI/180)},O=function(e,t,n){return g(function(e,t,n){return 15*(e+t/60+n/3600)}(e,t,n))},m=function(e,t,n){return g(function(e,t,n){return e+t/60+n/3600}(e,t,n))},p=a.a.createContext();function x(e){var t=e.children,n=Object(r.useState)("Equatorial"),a=Object(c.a)(n,2),o=a[0],i=a[1],s=Object(r.useState)("Oui"),u=Object(c.a)(s,2),d=u[0],f=u[1],j=Object(r.useState)(new Date),h=Object(c.a)(j,2),b=h[0],g=h[1],x=Object(r.useState)({latitude:null,longitude:null}),w=Object(c.a)(x,2),M=w[0],S=w[1],y=Object(r.useState)(null),E=Object(c.a)(y,2),C=E[0],N=E[1],T=Object(r.useState)({}),L=Object(c.a)(T,2),R=L[0],D=(L[1],Object(r.useState)(6)),I=Object(c.a)(D,2),k=I[0],F=I[1],P=Object(r.useState)([]),A=Object(c.a)(P,2),B=A[0],z=A[1],U=1e3;Object(r.useEffect)((function(){navigator.geolocation?navigator.geolocation.getCurrentPosition((function(e){S({latitude:e.coords.latitude,longitude:e.coords.longitude})}),(function(e){console.error("Erreur de g\xe9olocalisation:",e)})):console.error("G\xe9olocalisation non support\xe9e par ce navigateur.")}),[]),Object(r.useEffect)((function(){var e=setInterval((function(){g(new Date)}),1e3);return function(){return clearInterval(e)}}),[]);return Object(r.useEffect)((function(){fetch("".concat("/SkySphereJs","/datas/hip.tsv")).then((function(e){return e.text()})).then((function(e){var t=1/0,n=-1/0,r=1/0,a=-1/0,o=e.split("\n").filter((function(e){return!e.startsWith("#")&&""!==e.trim()})),i=[],c=[],s=o.map((function(e){return parseInt(e.split("|")[0])})).sort((function(e,t){return e-t})),u=Array.from({length:118322},(function(e,t){return t+1})).filter((function(e){return!s.includes(e)}));console.log("Missing HIP numbers:",u),o.forEach((function(e,o){var s=e.split("|"),u=parseInt(s[0],10);R[u]=o;var l=s[1].split(/\s+/).map((function(e){return parseFloat(e)})),d=s[2].split(/\s+/).map((function(e){return parseFloat(e)})),f=O.apply(void 0,Object(v.a)(l)),j=m.apply(void 0,Object(v.a)(d)),h=parseFloat(s[3]);f<t&&(t=f),f>n&&(n=f),j<r&&(r=j),j>a&&(a=j),isNaN(h)?console.error("Invalid magnitude value:",s[3]):c.push(h);var b=U*Math.cos(j)*Math.cos(f),g=U*Math.cos(j)*Math.sin(f),p=U*Math.sin(j);if(isNaN(b)||isNaN(p)||isNaN(g)?console.error("Problem with HIP="+s[0]):i.push(b,p,g),i.length/3!==c.length)throw console.error("Mismatch detected at line index:",o),console.error("Line content:",e),new Error("Mismatch in data arrays")})),console.log("Nb \xe9toiles:"+c.length),console.log("RA Range:",t,"-",n),console.log("DEC Range:",r,"-",a);var l=c.filter((function(e){return!isNaN(e)})),d=Math.min.apply(Math,Object(v.a)(l)),f=Math.max.apply(Math,Object(v.a)(l));console.log("Magnitude Range:",d,"-",f),N({vertices:i,magnitudes:c,hipToIndex:R})})),fetch("".concat("/SkySphereJs","/datas/constellation_line_hip.csv")).then((function(e){return e.text()})).then((function(e){var t=e.split("\n").filter((function(e){return!e.startsWith("#")&&""!==e.trim()})).map((function(e){var t=e.split(",");return{abbreviation:t[0],group:t[1],abbreviationGroup:t[2],startStar:parseInt(t[3]),endStar:parseInt(t[4])}}));z(t)}))}),[]),Object(l.jsx)(p.Provider,{value:{shownConstellations:d,toggleShownConstellations:function(){console.log("Toggle shown Constellations"),f("Oui"===d?"Non":"Oui")},maxShownMagnitude:k,setMaxShownMagnitude:F,starsData:C,setStarsData:N,representation:o,setRepresentation:i,currentTime:b,location:M,toggleRepresentation:function(){i("Equatorial"===o?"Horizontal":"Equatorial")},constellationLines:B},children:t})}var w=function(e){var t=e.rotation,n=Object(j.k)().scene,a=Object(r.useContext)(p),o=a.maxShownMagnitude,i=a.starsData,c=Object(r.useRef)(new u.Group);return Object(r.useEffect)((function(){c.current.rotation.y=t.y,c.current.rotation.x=t.x}),[t]),Object(r.useEffect)((function(){if(i){console.log("Mise \xe0 jour maxShownMagnitude= "+o);var e=new u.BufferGeometry;e.setAttribute("position",new u.Float32BufferAttribute(i.vertices,3)),e.setAttribute("magnitude",new u.Float32BufferAttribute(i.magnitudes,1));for(var t=new u.ShaderMaterial({uniforms:{starTexture:{value:function(){var e=document.createElement("canvas");e.width=64,e.height=64;var t=e.getContext("2d"),n=t.createRadialGradient(32,32,8,32,32,32);n.addColorStop(0,"rgba(255, 255, 255, 1)"),n.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=n,t.fillRect(0,0,e.width,e.height);var r=new u.Texture(e);return r.needsUpdate=!0,r}()},maxMagnitude:{value:o}},vertexShader:"\n                attribute float magnitude;\n                uniform float maxMagnitude;\n                varying float vMagnitude;\n                void main() {\n                    vMagnitude = magnitude;\n                    gl_PointSize = 1.0 + 19.0 * (1.0 - vMagnitude / maxMagnitude);\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                }\n            ",fragmentShader:"\n                uniform sampler2D starTexture;\n                uniform float maxMagnitude;\n                varying float vMagnitude;\n                void main() {\n                    if (vMagnitude > maxMagnitude) {\n                        discard;\n                    }\n                    gl_FragColor = texture2D(starTexture, gl_PointCoord);\n                }\n            ",transparent:!0,depthTest:!0,depthWrite:!1,blending:u.AdditiveBlending});c.current.children.length>0;)c.current.remove(c.current.children[0]);var r=new u.Points(e,t);return c.current.add(r),n.add(c.current),function(){n.remove(c.current)}}}),[i,n,o]),null};var M=function(e){var t=e.rotation,n=Object(j.k)().scene,a=Object(r.useContext)(p),o=a.starsData,i=a.constellationLines,c=Object(r.useRef)(new u.Group);return Object(r.useEffect)((function(){c.current.rotation.y=t.y,c.current.rotation.x=t.x}),[t]),Object(r.useEffect)((function(){if(o&&i){var e=new u.LineBasicMaterial({color:16777215});return i.forEach((function(t){var n=3*o.hipToIndex[t.startStar],r=3*o.hipToIndex[t.endStar];if(void 0!==o.vertices[n]&&void 0!==o.vertices[r]){var a=new u.Vector3(o.vertices[n],o.vertices[n+1],o.vertices[n+2]),i=new u.Vector3(o.vertices[r],o.vertices[r+1],o.vertices[r+2]),s=(new u.BufferGeometry).setFromPoints([a,i]),l=new u.Line(s,e);c.current.add(l)}})),n.add(c.current),function(){n.remove(c.current)}}}),[o,n,i]),null};n(21);var S=function(){var e=Object(r.useState)({x:0,y:0}),t=Object(c.a)(e,2),n=t[0],a=t[1],o=Object(r.useContext)(p),i=o.shownConstellations,s=o.representation,d=o.location;return Object(r.useEffect)((function(){if(console.log("Changement de representation"),"Equatorial"===s)a({x:0,y:0});else if("Horizontal"===s){var e=d.longitude,t=d.latitude,n=function(e){for(var t=280.16+(new Date-new Date(Date.UTC(2e3,0,1,12)))/864e5*360.9856235,n=(t%=360)+e;n<0;)n+=360;for(;n>360;)n-=360;return n}(e),r=u.MathUtils.degToRad(n),o=u.MathUtils.degToRad(90-t);a({x:o,y:r})}}),[s,d]),Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(w,{rotation:n}),"Oui"===i&&Object(l.jsx)(M,{rotation:n})]})};var y=function(){return Object(l.jsxs)(s.a,{style:{background:"#001122"},children:[Object(l.jsx)("orthographicCamera",{position:[0,0,0],left:-1e3,right:1e3,top:1e3,bottom:-1e3,near:.1,far:1e3}),Object(l.jsx)(S,{}),Object(l.jsx)(f,{}),Object(l.jsx)(d,{}),Object(l.jsx)("axesHelper",{args:[500]}),Object(l.jsx)("ambientLight",{intensity:.5}),Object(l.jsx)("directionalLight",{position:[0,0,5],intensity:1}),Object(l.jsx)(b,{})]})},E=n(2),C=n(3),N=n(4),T=n(5),L=function(e){Object(N.a)(n,e);var t=Object(T.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,e)).state={hasError:!1,error:null,errorInfo:null},r}return Object(C.a)(n,[{key:"componentDidCatch",value:function(e,t){console.error("Uncaught error:",e,t),this.setState({error:e,errorInfo:t})}},{key:"render",value:function(){return this.state.hasError?Object(l.jsxs)("div",{children:[Object(l.jsx)("h1",{children:"Quelque chose s'est mal pass\xe9."}),Object(l.jsxs)("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),Object(l.jsx)("br",{}),this.state.errorInfo.componentStack]})]}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),n}(r.Component);n(70);var R=function(){var e=Object(r.useContext)(p),t=e.maxShownMagnitude,n=e.setMaxShownMagnitude,a=e.representation,o=e.toggleRepresentation,i=e.shownConstellations,s=e.toggleShownConstellations,u=Object(r.useState)(t),d=Object(c.a)(u,2),f=d[0],j=d[1];return Object(l.jsxs)("div",{className:"sidebar",children:[Object(l.jsx)("h2",{className:"representation-title",children:a}),Object(l.jsx)("button",{onClick:o,children:"Basculer la repr\xe9sentation"}),Object(l.jsxs)("h2",{className:"constellations-title",children:["Constellations: ",i]}),Object(l.jsx)("div",{className:"toggle-btn ".concat("Oui"===i?"on":"off"),onClick:s,children:Object(l.jsx)("div",{className:"toggle-indicator"})}),Object(l.jsxs)("div",{className:"magnitude-slider",children:[Object(l.jsxs)("label",{children:["Magnitude maximale affich\xe9e: ",f]}),Object(l.jsx)("input",{type:"range",min:"0",max:"10",step:"0.1",value:f,onChange:function(e){var t=parseFloat(e.target.value);j(t),n(t)}})]})]})};n(71);var D=function(e){var t=e.deviceType,n=Object(r.useContext)(p),a=n.currentTime,o=n.location,i=a.getTimezoneOffset()/60;return Object(l.jsxs)("div",{className:"header",children:["mobile"!==t&&Object(l.jsx)("h1",{className:"header-title",children:"SkySphereJS"}),Object(l.jsxs)("div",{className:"right-section",children:[Object(l.jsx)("span",{className:"location",children:o.latitude&&o.longitude?"Lat: ".concat(o.latitude.toFixed(2),", Long: ").concat(o.longitude.toFixed(2)):"Localisation non disponible"}),Object(l.jsxs)("span",{className:"time",children:[" ",a.toLocaleTimeString()," UTC ",i>=0?"+":"",i]})]})]})};var I=function(){var e=Object(r.useState)(o(window.innerWidth)),t=Object(c.a)(e,2),n=t[0],a=t[1];function o(e){return console.log("Width="+e),e<768?"mobile":e<=1180?"tablette":"ordinateur"}return Object(r.useEffect)((function(){var e=function(){a(o(window.innerWidth))};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),Object(l.jsx)("div",{className:"App ".concat("mobile"===n?"mobile":""),children:Object(l.jsx)(x,{children:Object(l.jsxs)(L,{children:[Object(l.jsx)(D,{deviceType:n}),Object(l.jsx)("div",{className:"content",children:Object(l.jsx)(y,{})}),"mobile"!==n&&Object(l.jsx)(R,{})]})})})};i.a.createRoot(document.getElementById("root")).render(Object(l.jsx)(a.a.StrictMode,{children:Object(l.jsx)(I,{})}))}},[[72,1,2]]]);
//# sourceMappingURL=main.067ffca1.chunk.js.map